<h3>{{ "branchTable.BRANCHES" | translate }}</h3>
<p>{{ "branchTable.DESCRIPTION" | translate }}</p>
<div class="filter-menu">
  <form [formGroup]="filterForm" class="row g-3">
    <div class="col-md-6">
      <mat-form-field>
        <mat-label>{{ "branchTable.SEARCH" | translate }}</mat-label>
        <input
          matInput
          formControlName="search"
          placeholder="{{ 'branchTable.SEARCH_PLACEHOLDER' | translate }}"
          (input)="applyFilter()"
        />
      </mat-form-field>
    </div>
    <div class="col-md-6">
      <mat-form-field>
        <mat-label>{{ "branchTable.LOCATIONS" | translate }}</mat-label>
        <mat-select
          multiple
          formControlName="locations"
          (selectionChange)="applyFilter()"
        >
          <mat-option
            *ngFor="let location of uniqueLocations"
            [value]="location"
          >
            {{ location }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </form>

  <app-branches-table-download
    [branchData]="this.dataSource.filteredData"
  ></app-branches-table-download>
</div>
<div class="table-responsive">
  <table
    mat-table
    [dataSource]="dataSource"
    matSort
    (matSortChange)="announceSortChange($event)"
    class="mat-elevation-z8 branch-table table table-hover"
  >
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ "branchTable.NAME" | translate }}
      </th>
      <td mat-cell *matCellDef="let element">{{ element.name }}</td>
    </ng-container>
    <ng-container matColumnDef="postCode">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ "branchTable.POSTCODE" | translate }}
      </th>
      <td mat-cell *matCellDef="let element">{{ element.postCode }}</td>
    </ng-container>
    <ng-container matColumnDef="location">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ "branchTable.LOCATION" | translate }}
      </th>
      <td mat-cell *matCellDef="let element">{{ element.location }}</td>
    </ng-container>
    <ng-container matColumnDef="canton">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ "branchTable.CANTON" | translate }}
      </th>
      <td mat-cell *matCellDef="let element">{{ element.canton }}</td>
    </ng-container>
    <ng-container matColumnDef="edit">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        <button
          mat-icon-button
          [matMenuTriggerFor]="menu"
          (click)="$event.stopPropagation()"
        >
          <mat-icon>more_horiz</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <a mat-menu-item [routerLink]="['detail', element.id]">
            <mat-icon>info</mat-icon>
            <span>{{ "branchTable.DETAILS" | translate }}</span>
          </a>
          <button mat-menu-item (click)="editBranch(element.id)">
            <mat-icon>edit</mat-icon>
            <span>{{ "actions.EDIT" | translate }}</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="deleteBranch(element.id)">
            <mat-icon>delete</mat-icon>
            <span>{{ "actions.DELETE" | translate }}</span>
          </button>
        </mat-menu>
      </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      [routerLink]="['detail', row.id]"
      class="clickable-row"
    ></tr>
  </table>
</div>
<div
  class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-3"
>
  <a class="map-button mb-2 mb-md-0" [routerLink]="['/filialen/karte']">
    <button mat-button color="primary">
      {{ "branchTable.MAP" | translate }}
    </button>
  </a>
  <div class="flex-grow-1 mx-0 mx-md-3 mb-2 mb-md-0">
    <mat-paginator
      [length]="dataSource.filteredData.length"
      [pageSizeOptions]="[5, 10]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
  <div class="d-flex flex-column flex-md-row">
    <button
      mat-button
      (click)="addBranch()"
      color="primary"
      class="mb-2 mb-md-0 me-md-2"
    >
      {{ "actions.ADD" | translate }}
    </button>
    <input type="file" style="display:none" id="fileInput" accept=".csv,.json,.xlsx">
    <button mat-button color="primary">
      {{ "actions.IMPORT" | translate }}
    </button>
  </div>
</div>
